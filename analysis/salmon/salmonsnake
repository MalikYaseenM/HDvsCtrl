
import os
import re
import pandas

include: '../common_workflow.snake'
workdir: '../../samples'

salmon_matrix = 'all_salmon_quant.tsv'

#salmonpath='/projectnb/bubhub/bubhub-reference/genome/human/GENCODE/v25/gencode.v25.pc_lncRNA_transcripts.salmon_quasi_index'

#pathtogtf='/projectnb/bubhub/bubhub-reference/genome/human/GENCODE/v25/gencode.v25.annotation.gtf'

salmonpath='../reference/gencode.v25.pc_lncRNA_transcripts.salmon_quasi_index'
pathtogtf='../reference/gencode.v25.annotation.gtf'
count = expand('{sample}__salmon__counts', sample=dataset_ids)
salmon_concat = expand('{sample}__salmon__counts/quant.sf' sample = dataset_ids)

rule all:
  input:
    count,
<<<<<<< HEAD
    salmon_matrix
=======
    salmon_concat

>>>>>>> 7280ce03b92db6688cefe2f0a6fbb0f1ed900e80

rule salmonquant:
    input:
      read1="{sample}__R1.fastq.gz",
      read2="{sample}__R2.fastq.gz",
      gtf= pathtogtf,
      index= salmonpath
    output:
      file='{sample}__salmon__counts'
#    params:
#      prefix='{sample}__salmon__counts.'
    threads: 8
    shell:
      "salmon quant --index {input.index} -g {input.gtf} "
      "-l A -1 {input.read1} -2 {input.read2} --output {output.file} "
      "-p {threads} "

rule salmon_concat:
    input:
<<<<<<< HEAD
        salmon_concat
    output:
        "salmoncounts.tsv"
    run:
        mat = None
	for 
      quant=expand("../../samples/{sample}__salmon__counts/quant.sf sample=dataset_ids)
    output:
<<<<<<< HEAD
      matrix=salmon_matrix
    run:
      mat = None
      for fn in input.quant:
         sample_name = ??? import os???
         col_names = 
         df = pandas.read_csv(fn, sep='\t', skiprows=1, names=col_names)
         if mat is None:
            mat = df
         else: #we only need numreads?
            mat = pandas.concat([mat, df.iloc[:, 4:]], axis=1)
      mat.to_csv(output[0], sep='\t', index=False)
=======
      "../../samples/all_salmon_mRNASeq_counts.tsv"
    shell:
      all_samples_matrix = None
      for i in input.quant:
         sample_name =
         col_names = ['gene_id', 'Length', 'EffectiveLength', 'TPM', '{}'.format(sample_name)]
         df = pandas.read_csv(????)


>>>>>>> 7280ce03b92db6688cefe2f0a6fbb0f1ed900e80
